---
- name: Playbook para instalar MySQL en Ubuntu
  hosts: all
  become: yes
  vars:
    mysql_root_password: "Huawei1234"

  tasks:
    - name: Instalar MySQL Server
      apt:
        name: mysql-server
        state: present

    - name: Configurar la contraseña root de MySQL y asegurar la instalación
      shell: |
        sudo mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH 'mysql_native_password' BY '{{ mysql_root_password }}';"
        sudo mysql -e "DELETE FROM mysql.user WHERE User='';"
        sudo mysql -e "DROP DATABASE IF EXISTS test;"
        sudo mysql -e "DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';"
        sudo mysql -e "FLUSH PRIVILEGES;"
      args:
        executable: /bin/bash

    - name: Iniciar y habilitar el servicio de MySQL
      service:
        name: mysql
        state: started
        enabled: yes
